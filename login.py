from selenium import webdriver
import time
from selenium.webdriver.common.keys import Keys
from common import Wait
from selenium.webdriver.chrome.options import Options
from GetTeams import *
from firebaseCom import *

Sleep_time = 2
error_count = 10

def login(browser,initial_url,email,password,uid):
    try:
        browser.get(initial_url)
    except:
        print("Initial url is invalid.........")
        quit()
    print("Initial Page Loaded....")
    Wait(Sleep_time)

    #Entering Email
    e_c = 0
    while(True):
        try:
            email_element = browser.find_element_by_name("loginfmt")
        except:
            e_c += 1
            if e_c > error_count:
                print("Some thing got wrong in Getting email Element in login form.....")
                quit()
            Wait(Sleep_time)
            continue
        email_element.send_keys(email)
        email_element.send_keys(Keys.RETURN)
        Wait(Sleep_time)
        break

    #Entering Password
    e_c = 0
    while (True):
        try:
            password_element = browser.find_element_by_name("passwd")
        except:
            e_c += 1
            if e_c > error_count:
                print("Some thing got wrong in Getting password Element in login form.....")
                quit()
            Wait(Sleep_time)
            continue
        password_element.send_keys(password)
        password_element.send_keys(Keys.RETURN)
        Wait(Sleep_time)
        break

    #Clicking Yes Button afetr loging in for staylogin
    e_c = 0
    while(True) :
        try:
            yes_button = browser.find_element_by_id("idSIButton9")
        except:
            e_c += 1
            if e_c > error_count :
                print("Some thing went wrong in Getting Yes Buttton....")
                quit()
            Wait(Sleep_time)
            continue
        yes_button.click()
        Wait(Sleep_time)
        break

    #Clicking Use web only
    # e_c = 0
    # while(True):
    #     try:
    #         useweb_button = browser.find_element_by_class_name("use-app-lnk")
    #     except:
    #         e_c += 1
    #         if e_c > error_count:
    #             print("Some thing went wrong in Getting Use Web Buttton....")
    #             quit()
    #         Wait(Sleep_time)
    #         continue
    #     useweb_button.click()
    #     Wait(Sleep_time)
    #     break

    # Clicking Decline Button
    e_c = 0
    while True:
        AB_buttons = browser.find_elements_by_class_name("action-button ")
        if len(AB_buttons)==0:
            e_c += 1
            if e_c > error_count:
                print("Some thing went wrong in Getting Decline Buttton....")
                quit()
            Wait(Sleep_time)
            continue
        AB_buttons[1].click()
        Wait(Sleep_time)
        break

    updateTeamNames(uid,GetTeams_names(browser))
    